<!DOCTYPE html>
<html>
<head>
  <title>schematics</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/schematics";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>schematics</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-meta">"use strict"</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> __createBinding = (<span class="hljs-keyword">this</span> &amp;&amp; <span class="hljs-keyword">this</span>.__createBinding) || (<span class="hljs-built_in">Object</span>.create ? (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">o, m, k, k2</span>) </span>{
    <span class="hljs-keyword">if</span> (k2 === <span class="hljs-literal">undefined</span>) k2 = k;
    <span class="hljs-keyword">var</span> desc = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(m, k);
    <span class="hljs-keyword">if</span> (!desc || (<span class="hljs-string">"get"</span> <span class="hljs-keyword">in</span> desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> m[k]; } };
    }
    <span class="hljs-built_in">Object</span>.defineProperty(o, k2, desc);
}) : (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">o, m, k, k2</span>) </span>{
    <span class="hljs-keyword">if</span> (k2 === <span class="hljs-literal">undefined</span>) k2 = k;
    o[k2] = m[k];
}));
<span class="hljs-keyword">var</span> __setModuleDefault = (<span class="hljs-keyword">this</span> &amp;&amp; <span class="hljs-keyword">this</span>.__setModuleDefault) || (<span class="hljs-built_in">Object</span>.create ? (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">o, v</span>) </span>{
    <span class="hljs-built_in">Object</span>.defineProperty(o, <span class="hljs-string">"default"</span>, { <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>: v });
}) : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">o, v</span>) </span>{
    o[<span class="hljs-string">"default"</span>] = v;
});
<span class="hljs-keyword">var</span> __importStar = (<span class="hljs-keyword">this</span> &amp;&amp; <span class="hljs-keyword">this</span>.__importStar) || (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> ownKeys = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">o</span>) </span>{
        ownKeys = <span class="hljs-built_in">Object</span>.getOwnPropertyNames || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">o</span>) </span>{
            <span class="hljs-keyword">var</span> ar = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k <span class="hljs-keyword">in</span> o) <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            <span class="hljs-keyword">return</span> ar;
        };
        <span class="hljs-keyword">return</span> ownKeys(o);
    };
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mod</span>) </span>{
        <span class="hljs-keyword">if</span> (mod &amp;&amp; mod.__esModule) <span class="hljs-keyword">return</span> mod;
        <span class="hljs-keyword">var</span> result = {};
        <span class="hljs-keyword">if</span> (mod != <span class="hljs-literal">null</span>) <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = ownKeys(mod), i = <span class="hljs-number">0</span>; i &lt; k.length; i++) <span class="hljs-keyword">if</span> (k[i] !== <span class="hljs-string">"default"</span>) __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        <span class="hljs-keyword">return</span> result;
    };
})();
<span class="hljs-keyword">var</span> __importDefault = (<span class="hljs-keyword">this</span> &amp;&amp; <span class="hljs-keyword">this</span>.__importDefault) || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mod</span>) </span>{
    <span class="hljs-keyword">return</span> (mod &amp;&amp; mod.__esModule) ? mod : { <span class="hljs-string">"default"</span>: mod };
};
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.main = main;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>symbol polyfill must go first</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-built_in">require</span>(<span class="hljs-string">"symbol-observable"</span>);
<span class="hljs-keyword">const</span> core_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@angular-devkit/core"</span>);
<span class="hljs-keyword">const</span> node_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@angular-devkit/core/node"</span>);
<span class="hljs-keyword">const</span> schematics_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@angular-devkit/schematics"</span>);
<span class="hljs-keyword">const</span> tools_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@angular-devkit/schematics/tools"</span>);
<span class="hljs-keyword">const</span> ansi_colors_1 = __importDefault(<span class="hljs-built_in">require</span>(<span class="hljs-string">"ansi-colors"</span>));
<span class="hljs-keyword">const</span> node_fs_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"node:fs"</span>);
<span class="hljs-keyword">const</span> path = __importStar(<span class="hljs-built_in">require</span>(<span class="hljs-string">"node:path"</span>));
<span class="hljs-keyword">const</span> yargs_parser_1 = __importStar(<span class="hljs-built_in">require</span>(<span class="hljs-string">"yargs-parser"</span>));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Parse the name of schematic passed in argument, and return a {collection, schematic} named
tuple. The user can pass in <code>collection-name:schematic-name</code>, and this function will either
return <code>{collection: 'collection-name', schematic: 'schematic-name'}</code>, or it will error out
and show usage.</p>
</div>
<div class="body">
<p>In the case where a collection name isn't part of the argument, the default is to use the
schematics package (@angular-devkit/schematics-cli) as the collection.</p>
<p>This logic is entirely up to the tooling.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">str</span>
<span>The argument to parse.
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">[object Object]</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseSchematicName</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">let</span> collection = <span class="hljs-string">'@angular-devkit/schematics-cli'</span>;
    <span class="hljs-keyword">let</span> schematic = str;
    <span class="hljs-keyword">if</span> (schematic?.includes(<span class="hljs-string">':'</span>)) {
        <span class="hljs-keyword">const</span> lastIndexOfColon = schematic.lastIndexOf(<span class="hljs-string">':'</span>);
        [collection, schematic] = [
            schematic.slice(<span class="hljs-number">0</span>, lastIndexOfColon),
            schematic.substring(lastIndexOfColon + <span class="hljs-number">1</span>),
        ];
    }
    <span class="hljs-keyword">return</span> { collection, schematic };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeLeadingSlash</span>(<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">return</span> value[<span class="hljs-number">0</span>] === <span class="hljs-string">'/'</span> ? value.slice(<span class="hljs-number">1</span>) : value;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_listSchematics</span>(<span class="hljs-params">workflow, collectionName, logger</span>) </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> collection = workflow.engine.createCollection(collectionName);
        logger.info(collection.listSchematicNames().join(<span class="hljs-string">'\n'</span>));
    }
    <span class="hljs-keyword">catch</span> (error) {
        logger.fatal(error <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span> ? error.message : <span class="hljs-string">`<span class="hljs-subst">${error}</span>`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_createPromptProvider</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (definitions) =&gt; {
        <span class="hljs-keyword">let</span> prompts;
        <span class="hljs-keyword">const</span> answers = {};
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> definition <span class="hljs-keyword">of</span> definitions) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Only load prompt package if needed</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            prompts ??= <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.resolve().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> __importStar(<span class="hljs-built_in">require</span>(<span class="hljs-string">'@inquirer/prompts'</span>)));
            <span class="hljs-keyword">switch</span> (definition.type) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">'confirmation'</span>:
                    answers[definition.id] = <span class="hljs-keyword">await</span> prompts.confirm({
                        <span class="hljs-attr">message</span>: definition.message,
                        <span class="hljs-attr">default</span>: definition.default,
                    });
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'list'</span>:
                    <span class="hljs-keyword">if</span> (!definition.items?.length) {
                        <span class="hljs-keyword">continue</span>;
                    }
                    answers[definition.id] = <span class="hljs-keyword">await</span> (definition.multiselect ? prompts.checkbox : prompts.select)({
                        <span class="hljs-attr">message</span>: definition.message,
                        <span class="hljs-attr">default</span>: definition.default,
                        <span class="hljs-attr">validate</span>: <span class="hljs-function">(<span class="hljs-params">values</span>) =&gt;</span> {
                            <span class="hljs-keyword">if</span> (!definition.validator) {
                                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                            }
                            <span class="hljs-keyword">return</span> definition.validator(<span class="hljs-built_in">Object</span>.values(values).map(<span class="hljs-function">(<span class="hljs-params">{ value }</span>) =&gt;</span> value));
                        },
                        <span class="hljs-attr">choices</span>: definition.items.map(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-keyword">typeof</span> item == <span class="hljs-string">'string'</span>
                            ? {
                                <span class="hljs-attr">name</span>: item,
                                <span class="hljs-attr">value</span>: item,
                            }
                            : {
                                <span class="hljs-attr">name</span>: item.label,
                                <span class="hljs-attr">value</span>: item.value,
                            }),
                    });
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'input'</span>: {
                    <span class="hljs-keyword">let</span> finalValue;
                    answers[definition.id] = <span class="hljs-keyword">await</span> prompts.input({
                        <span class="hljs-attr">message</span>: definition.message,
                        <span class="hljs-attr">default</span>: definition.default,
                        <span class="hljs-keyword">async</span> validate(value) {
                            <span class="hljs-keyword">if</span> (definition.validator === <span class="hljs-literal">undefined</span>) {
                                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                            }
                            <span class="hljs-keyword">let</span> lastValidation = <span class="hljs-literal">false</span>;
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> type <span class="hljs-keyword">of</span> definition.propertyTypes) {
                                <span class="hljs-keyword">let</span> potential;
                                <span class="hljs-keyword">switch</span> (type) {
                                    <span class="hljs-keyword">case</span> <span class="hljs-string">'string'</span>:
                                        potential = <span class="hljs-built_in">String</span>(value);
                                        <span class="hljs-keyword">break</span>;
                                    <span class="hljs-keyword">case</span> <span class="hljs-string">'integer'</span>:
                                    <span class="hljs-keyword">case</span> <span class="hljs-string">'number'</span>:
                                        potential = <span class="hljs-built_in">Number</span>(value);
                                        <span class="hljs-keyword">break</span>;
                                    <span class="hljs-keyword">default</span>:
                                        potential = value;
                                        <span class="hljs-keyword">break</span>;
                                }
                                lastValidation = <span class="hljs-keyword">await</span> definition.validator(potential);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Can be a string if validation fails</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                                <span class="hljs-keyword">if</span> (lastValidation === <span class="hljs-literal">true</span>) {
                                    finalValue = potential;
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                                }
                            }
                            <span class="hljs-keyword">return</span> lastValidation;
                        },
                    });
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Use validated value if present.
This ensures the correct type is inserted into the final schema options.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    <span class="hljs-keyword">if</span> (finalValue !== <span class="hljs-literal">undefined</span>) {
                        answers[definition.id] = finalValue;
                    }
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
        <span class="hljs-keyword">return</span> answers;
    };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findUp</span>(<span class="hljs-params">names, from</span>) </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(names)) {
        names = [names];
    }
    <span class="hljs-keyword">const</span> root = path.parse(<span class="hljs-keyword">from</span>).root;
    <span class="hljs-keyword">let</span> currentDir = <span class="hljs-keyword">from</span>;
    <span class="hljs-keyword">while</span> (currentDir &amp;&amp; currentDir !== root) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">of</span> names) {
            <span class="hljs-keyword">const</span> p = path.join(currentDir, name);
            <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, node_fs_1.existsSync)(p)) {
                <span class="hljs-keyword">return</span> p;
            }
        }
        currentDir = path.dirname(currentDir);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>return package manager' name by lock file</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPackageManagerName</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>order by check priority</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> LOCKS = {
        <span class="hljs-string">'package-lock.json'</span>: <span class="hljs-string">'npm'</span>,
        <span class="hljs-string">'yarn.lock'</span>: <span class="hljs-string">'yarn'</span>,
        <span class="hljs-string">'pnpm-lock.yaml'</span>: <span class="hljs-string">'pnpm'</span>,
    };
    <span class="hljs-keyword">const</span> lockPath = findUp(<span class="hljs-built_in">Object</span>.keys(LOCKS), process.cwd());
    <span class="hljs-keyword">if</span> (lockPath) {
        <span class="hljs-keyword">return</span> LOCKS[path.basename(lockPath)];
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">'npm'</span>;
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>eslint-disable-next-line max-lines-per-function</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params">{ args, stdout = process.stdout, stderr = process.stderr, }</span>) </span>{
    <span class="hljs-keyword">const</span> { cliOptions, schematicOptions, _ } = parseArgs(args);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Create a separate instance to prevent unintended global changes to the color configuration</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> colors = ansi_colors_1.default.create();
    <span class="hljs-comment">/** Create the DevKit Logger used through the CLI. */</span>
    <span class="hljs-keyword">const</span> logger = (<span class="hljs-number">0</span>, node_1.createConsoleLogger)(!!cliOptions.verbose, stdout, stderr, {
        <span class="hljs-attr">info</span>: <span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s,
        <span class="hljs-attr">debug</span>: <span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s,
        <span class="hljs-attr">warn</span>: <span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> colors.bold.yellow(s),
        <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> colors.bold.red(s),
        <span class="hljs-attr">fatal</span>: <span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> colors.bold.red(s),
    });
    <span class="hljs-keyword">if</span> (cliOptions.help) {
        logger.info(getUsage());
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    <span class="hljs-comment">/** Get the collection an schematic name from the first argument. */</span>
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">collection</span>: collectionName, <span class="hljs-attr">schematic</span>: schematicName } = parseSchematicName(_.shift() || <span class="hljs-literal">null</span>);
    <span class="hljs-keyword">const</span> isLocalCollection = collectionName.startsWith(<span class="hljs-string">'.'</span>) || collectionName.startsWith(<span class="hljs-string">'/'</span>);
    <span class="hljs-comment">/** Gather the arguments for later use. */</span>
    <span class="hljs-keyword">const</span> debugPresent = cliOptions.debug !== <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> debug = debugPresent ? !!cliOptions.debug : isLocalCollection;
    <span class="hljs-keyword">const</span> dryRunPresent = cliOptions[<span class="hljs-string">'dry-run'</span>] !== <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> dryRun = dryRunPresent ? !!cliOptions[<span class="hljs-string">'dry-run'</span>] : debug;
    <span class="hljs-keyword">const</span> force = !!cliOptions.force;
    <span class="hljs-keyword">const</span> allowPrivate = !!cliOptions[<span class="hljs-string">'allow-private'</span>];
    <span class="hljs-comment">/** Create the workflow scoped to the working directory that will be executed with this run. */</span>
    <span class="hljs-keyword">const</span> workflow = <span class="hljs-keyword">new</span> tools_1.NodeWorkflow(process.cwd(), {
        force,
        dryRun,
        <span class="hljs-attr">resolvePaths</span>: [process.cwd(), __dirname],
        <span class="hljs-attr">schemaValidation</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">packageManager</span>: getPackageManagerName(),
    });
    <span class="hljs-comment">/** If the user wants to list schematics, we simply show all the schematic names. */</span>
    <span class="hljs-keyword">if</span> (cliOptions[<span class="hljs-string">'list-schematics'</span>]) {
        <span class="hljs-keyword">return</span> _listSchematics(workflow, collectionName, logger);
    }
    <span class="hljs-keyword">if</span> (!schematicName) {
        logger.info(getUsage());
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">if</span> (debug) {
        logger.info(<span class="hljs-string">`Debug mode enabled<span class="hljs-subst">${isLocalCollection ? <span class="hljs-string">' by default for local collections'</span> : <span class="hljs-string">''</span>}</span>.`</span>);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Indicate to the user when nothing has been done. This is automatically set to off when there's
a new DryRunEvent.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">let</span> nothingDone = <span class="hljs-literal">true</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>Logging queue that receives all the messages to show the users. This only get shown when no
errors happened.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">let</span> loggingQueue = [];
    <span class="hljs-keyword">let</span> error = <span class="hljs-literal">false</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>Logs out dry run events.</p>
</div>
<div class="body">
<p>All events will always be executed here, in order of discovery. That means that an error would
be shown along other events when it happens. Since errors in workflows will stop the Observable
from completing successfully, we record any events other than errors, then on completion we
show them.</p>
<p>This is a simple way to only show errors when an error occur.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    workflow.reporter.subscribe(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        nothingDone = <span class="hljs-literal">false</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Strip leading slash to prevent confusion.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> eventPath = removeLeadingSlash(event.path);
        <span class="hljs-keyword">switch</span> (event.kind) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'error'</span>:
                error = <span class="hljs-literal">true</span>;
                logger.error(<span class="hljs-string">`ERROR! <span class="hljs-subst">${eventPath}</span> <span class="hljs-subst">${event.description == <span class="hljs-string">'alreadyExist'</span> ? <span class="hljs-string">'already exists'</span> : <span class="hljs-string">'does not exist'</span>}</span>.`</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'update'</span>:
                loggingQueue.push(<span class="hljs-string">`<span class="hljs-subst">${colors.cyan(<span class="hljs-string">'UPDATE'</span>)}</span> <span class="hljs-subst">${eventPath}</span> (<span class="hljs-subst">${event.content.length}</span> bytes)`</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'create'</span>:
                loggingQueue.push(<span class="hljs-string">`<span class="hljs-subst">${colors.green(<span class="hljs-string">'CREATE'</span>)}</span> <span class="hljs-subst">${eventPath}</span> (<span class="hljs-subst">${event.content.length}</span> bytes)`</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'delete'</span>:
                loggingQueue.push(<span class="hljs-string">`<span class="hljs-subst">${colors.yellow(<span class="hljs-string">'DELETE'</span>)}</span> <span class="hljs-subst">${eventPath}</span>`</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'rename'</span>:
                loggingQueue.push(<span class="hljs-string">`<span class="hljs-subst">${colors.blue(<span class="hljs-string">'RENAME'</span>)}</span> <span class="hljs-subst">${eventPath}</span> =&gt; <span class="hljs-subst">${removeLeadingSlash(event.to)}</span>`</span>);
                <span class="hljs-keyword">break</span>;
        }
    });
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<div class="dox">
<div class="summary">
<p>Listen to lifecycle events of the workflow to flush the logs between each phases.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    workflow.lifeCycle.subscribe(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (event.kind == <span class="hljs-string">'workflow-end'</span> || event.kind == <span class="hljs-string">'post-tasks-start'</span>) {
            <span class="hljs-keyword">if</span> (!error) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Flush the log queue and clean the error state.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                loggingQueue.forEach(<span class="hljs-function">(<span class="hljs-params">log</span>) =&gt;</span> logger.info(log));
            }
            loggingQueue = [];
            error = <span class="hljs-literal">false</span>;
        }
    });
    workflow.registry.addPostTransform(core_1.schema.transforms.addUndefinedDefaults);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Show usage of deprecated options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    workflow.registry.useXDeprecatedProvider(<span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> logger.warn(msg));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>Pass the rest of the arguments as the smart default &quot;argv&quot;. Then delete it.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    workflow.registry.addSmartDefaultProvider(<span class="hljs-string">'argv'</span>, (schema) =&gt; <span class="hljs-string">'index'</span> <span class="hljs-keyword">in</span> schema ? _[<span class="hljs-built_in">Number</span>(schema[<span class="hljs-string">'index'</span>])] : _);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>Add prompts.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (cliOptions.interactive &amp;&amp; isTTY()) {
        workflow.registry.usePromptProvider(_createPromptProvider());
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<div class="dox">
<div class="summary">
<p>Execute the workflow, which will report the dry run events, run the tasks, and complete
after all is done.</p>
</div>
<div class="body">
<p>The Observable returned will properly cancel the workflow if unsubscribed, error out if ANY
step of the workflow failed (sink or task), with details included, and will only complete
when everything is done.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> workflow
            .execute({
            <span class="hljs-attr">collection</span>: collectionName,
            <span class="hljs-attr">schematic</span>: schematicName,
            <span class="hljs-attr">options</span>: schematicOptions,
            <span class="hljs-attr">allowPrivate</span>: allowPrivate,
            <span class="hljs-attr">debug</span>: debug,
            <span class="hljs-attr">logger</span>: logger,
        })
            .toPromise();
        <span class="hljs-keyword">if</span> (nothingDone) {
            logger.info(<span class="hljs-string">'Nothing to be done.'</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dryRun) {
            logger.info(<span class="hljs-string">`Dry run enabled<span class="hljs-subst">${dryRunPresent ? <span class="hljs-string">''</span> : <span class="hljs-string">' by default in debug mode'</span>}</span>. No files written to disk.`</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> schematics_1.UnsuccessfulWorkflowExecution) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>&quot;See above&quot; because we already printed the error.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            logger.fatal(<span class="hljs-string">'The Schematic workflow failed. See above.'</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (debug &amp;&amp; err <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) {
            logger.fatal(<span class="hljs-string">`An error occured:\n<span class="hljs-subst">${err.stack}</span>`</span>);
        }
        <span class="hljs-keyword">else</span> {
            logger.fatal(<span class="hljs-string">`Error: <span class="hljs-subst">${err <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span> ? err.message : err}</span>`</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get usage of the CLI tool.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUsage</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
schematics [collection-name:]schematic-name [options, ...]

By default, if the collection name is not specified, use the internal collection provided
by the Schematics CLI.

Options:
    --debug             Debug mode. This is true by default if the collection is a relative
                        path (in that case, turn off with --debug=false).

    --allow-private     Allow private schematics to be run from the command line. Default to
                        false.

    --dry-run           Do not output anything, but instead just show what actions would be
                        performed. Default to true if debug is also true.

    --force             Force overwriting files that would otherwise be an error.

    --list-schematics   List all schematics from the collection, by name. A collection name
                        should be suffixed by a colon. Example: '@angular-devkit/schematics-cli:'.

    --no-interactive    Disables interactive input prompts.

    --verbose           Show more information.

    --help              Show this message.

Any additional option is passed to the Schematics depending on its schema.
`</span>;
}
<span class="hljs-comment">/** Parse the command line. */</span>
<span class="hljs-keyword">const</span> booleanArgs = [
    <span class="hljs-string">'allow-private'</span>,
    <span class="hljs-string">'debug'</span>,
    <span class="hljs-string">'dry-run'</span>,
    <span class="hljs-string">'force'</span>,
    <span class="hljs-string">'help'</span>,
    <span class="hljs-string">'list-schematics'</span>,
    <span class="hljs-string">'verbose'</span>,
    <span class="hljs-string">'interactive'</span>,
];
<span class="hljs-comment">/** Parse the command line. */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseArgs</span>(<span class="hljs-params">args</span>) </span>{
    <span class="hljs-keyword">const</span> { _, ...options } = (<span class="hljs-number">0</span>, yargs_parser_1.default)(args, {
        <span class="hljs-attr">boolean</span>: booleanArgs,
        <span class="hljs-attr">default</span>: {
            <span class="hljs-string">'interactive'</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">'debug'</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-string">'dry-run'</span>: <span class="hljs-literal">null</span>,
        },
        <span class="hljs-attr">configuration</span>: {
            <span class="hljs-string">'dot-notation'</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">'boolean-negation'</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">'strip-aliased'</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">'camel-case-expansion'</span>: <span class="hljs-literal">false</span>,
        },
    });
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Camelize options as yargs will return the object in kebab-case when camel casing is disabled.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> schematicOptions = {};
    <span class="hljs-keyword">const</span> cliOptions = {};
    <span class="hljs-keyword">const</span> isCliOptions = <span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> booleanArgs.includes(key);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> <span class="hljs-built_in">Object</span>.entries(options)) {
        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[A-Z]/</span>.test(key)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Unknown argument <span class="hljs-subst">${key}</span>. Did you mean <span class="hljs-subst">${(<span class="hljs-number">0</span>, yargs_parser_1.decamelize)(key)}</span>?`</span>);
        }
        <span class="hljs-keyword">if</span> (isCliOptions(key)) {
            cliOptions[key] = value;
        }
        <span class="hljs-keyword">else</span> {
            schematicOptions[(<span class="hljs-number">0</span>, yargs_parser_1.camelCase)(key)] = value;
        }
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">_</span>: _.map(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> v.toString()),
        schematicOptions,
        cliOptions,
    };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isTTY</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> isTruthy = <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Returns true if value is a string that is anything but 0 or false.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> value !== <span class="hljs-literal">undefined</span> &amp;&amp; value !== <span class="hljs-string">'0'</span> &amp;&amp; value.toUpperCase() !== <span class="hljs-string">'FALSE'</span>;
    };
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>If we force TTY, we always return true.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> force = process.env[<span class="hljs-string">'NG_FORCE_TTY'</span>];
    <span class="hljs-keyword">if</span> (force !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">return</span> isTruthy(force);
    }
    <span class="hljs-keyword">return</span> !!process.stdout.isTTY &amp;&amp; !isTruthy(process.env[<span class="hljs-string">'CI'</span>]);
}
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.main === <span class="hljs-built_in">module</span>) {
    <span class="hljs-keyword">const</span> args = process.argv.slice(<span class="hljs-number">2</span>);
    main({ args })
        .then(<span class="hljs-function">(<span class="hljs-params">exitCode</span>) =&gt;</span> (process.exitCode = exitCode))
        .catch(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
        <span class="hljs-keyword">throw</span> e;
    });
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
